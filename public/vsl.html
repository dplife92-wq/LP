<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Formation Gratuite - Professeurs Particuliers 5000‚Ç¨/mois</title>
    <meta name="description" content="Votre formation gratuite de 30 minutes pour g√©n√©rer 5000‚Ç¨/mois en tant que professeur particulier">
    
    <!-- Klaviyo Integration pour tracking -->
    <script async type="text/javascript" src="https://static.klaviyo.com/onsite/js/klaviyo.js?company_id=Xg9gNa"></script>
    
    <style>
        /* Reset & Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            font-size: 16px;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: white;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Titre */
        h1 {
            font-size: 24px;
            font-weight: 700;
            color: #6A5ACD;
            margin-bottom: 30px;
            text-align: center;
        }
        
        @media (min-width: 768px) {
            h1 {
                font-size: 28px;
                margin-bottom: 40px;
            }
        }
        
        /* Container principal */
        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            text-align: center;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* Section vid√©o/contenu */
        .content-section {
            width: 100%;
            margin-bottom: 40px;
        }
        
        .video-container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            aspect-ratio: 16/9;
            background-color: #f5f5f5;
            border: 2px dashed #ddd;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 16px;
        }
        
        .placeholder-text {
            color: #999;
            font-size: 18px;
            font-weight: 500;
        }
        
        .placeholder-icon {
            font-size: 48px;
            color: #ddd;
        }
        
        /* Bouton CTA - Style violet de la page principale */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 32px;
            background: #6A5ACD;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(106, 90, 205, 0.3);
        }
        
        .btn:hover, .btn:focus {
            background: #483D8B;
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(106, 90, 205, 0.4);
            outline: none;
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-icon {
            font-size: 18px;
        }
        
        /* Info utilisateur */
        .user-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            font-size: 16px;
            color: #555;
        }
        
        .user-name {
            color: #6A5ACD;
            font-weight: 600;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 20px 16px;
            }
            
            .placeholder-text {
                font-size: 16px;
            }
            
            .placeholder-icon {
                font-size: 36px;
            }
            
            .btn {
                padding: 14px 24px;
                font-size: 14px;
            }
        }
        
        @media (max-width: 480px) {
            .btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Titre -->
        <h1>30 minutes de formation vid√©o (comme promis) :</h1>
        
        <!-- Info utilisateur -->
        <div class="user-info" id="userInfo" style="display: none;">
            Bonjour <span class="user-name" id="userName"></span> ! 
            Voici votre formation personnalis√©e.
        </div>
        
        <!-- Section Vid√©o/Contenu -->
        <div class="content-section">
            <div class="video-container" id="videoContainer">
                <div class="placeholder-icon">üé¨</div>
                <div class="placeholder-text">Vid√©o ou contenu √† ajouter ici</div>
            </div>
        </div>
        
        <!-- Bouton CTA -->
        <button class="btn" id="ctaButton">
            <span class="btn-icon">üöÄ</span>
            Acc√©der au programme complet
        </button>
    </div>

    <script>
        // Tracking des √©v√©nements
        function trackEvent(eventName, properties = {}) {
            if (window._learnq) {
                window._learnq.push(['track', eventName, {
                    ...properties,
                    'page': 'vsl_page',
                    'timestamp': new Date().toISOString()
                }]);
            }
            console.log('üìä Event tracked:', eventName, properties);
        }
        
        // R√©cup√©ration des param√®tres URL
        function getURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                firstName: urlParams.get('firstName') || '',
                email: urlParams.get('email') || '',
                timestamp: urlParams.get('timestamp') || ''
            };
        }
        
        // üîß FONCTION DE REDIRECTION VERS LA PAGE DE FORMATION (CORRIG√âE)
        function redirectToFormation(firstName, email) {
            console.log('üéØ === REDIRECTION VERS PAGE DE FORMATION ===');
            console.log('Pr√©nom:', firstName);
            console.log('Email:', email);
            
            // ‚úÖ CORRECTION : Essayer d'abord /formation, puis fallback vers formation.html
            let formationUrl;
            
            try {
                // Essayer avec clean URL d'abord
                formationUrl = new URL('/formation', window.location.origin);
                
                // Ajouter les param√®tres si disponibles
                if (firstName) formationUrl.searchParams.set('firstName', firstName);
                if (email) formationUrl.searchParams.set('email', email);
                formationUrl.searchParams.set('source', 'vsl');
                formationUrl.searchParams.set('timestamp', new Date().toISOString());
                
                console.log('üîó URL de redirection (clean):', formationUrl.toString());
                
                // Track la redirection
                trackEvent('Redirected to Formation Page', {
                    'firstName': firstName,
                    'email': email,
                    'formation_url': formationUrl.toString(),
                    'source': 'vsl_cta',
                    'url_type': 'clean'
                });
                
                // Rediriger vers la page de formation
                window.location.href = formationUrl.toString();
                
            } catch (error) {
                console.warn('‚ö†Ô∏è Erreur avec clean URL, fallback vers .html:', error);
                
                // Fallback vers formation.html
                formationUrl = new URL('/formation.html', window.location.origin);
                
                if (firstName) formationUrl.searchParams.set('firstName', firstName);
                if (email) formationUrl.searchParams.set('email', email);
                formationUrl.searchParams.set('source', 'vsl');
                formationUrl.searchParams.set('timestamp', new Date().toISOString());
                
                console.log('üîó URL de redirection (fallback):', formationUrl.toString());
                
                trackEvent('Redirected to Formation Page', {
                    'firstName': firstName,
                    'email': email,
                    'formation_url': formationUrl.toString(),
                    'source': 'vsl_cta',
                    'url_type': 'fallback'
                });
                
                window.location.href = formationUrl.toString();
            }
        }
        
        // üÜï FONCTION DE TEST POUR V√âRIFIER LA DISPONIBILIT√â DES PAGES
        async function checkPageAvailability() {
            try {
                // Tester /formation
                const response = await fetch('/formation', { method: 'HEAD' });
                if (response.ok) {
                    console.log('‚úÖ /formation accessible');
                    return '/formation';
                } else {
                    console.log('‚ùå /formation non accessible, utilisation de formation.html');
                    return '/formation.html';
                }
            } catch (error) {
                console.log('‚ùå Erreur test /formation, utilisation de formation.html');
                return '/formation.html';
            }
        }
        
        // üÜï REDIRECTION INTELLIGENTE AVEC TEST
        async function smartRedirectToFormation(firstName, email) {
            console.log('üß† === REDIRECTION INTELLIGENTE VERS FORMATION ===');
            
            // Tester quelle URL fonctionne
            const availableUrl = await checkPageAvailability();
            
            // Construire l'URL finale
            const formationUrl = new URL(availableUrl, window.location.origin);
            
            if (firstName) formationUrl.searchParams.set('firstName', firstName);
            if (email) formationUrl.searchParams.set('email', email);
            formationUrl.searchParams.set('source', 'vsl');
            formationUrl.searchParams.set('timestamp', new Date().toISOString());
            
            console.log('üîó URL finale s√©lectionn√©e:', formationUrl.toString());
            
            // Track la redirection
            trackEvent('Smart Redirect to Formation', {
                'firstName': firstName,
                'email': email,
                'formation_url': formationUrl.toString(),
                'source': 'vsl_cta',
                'selected_url': availableUrl
            });
            
            // Rediriger
            window.location.href = formationUrl.toString();
        }
        
        // Affichage des informations utilisateur
        function displayUserInfo() {
            const params = getURLParams();
            
            if (params.firstName) {
                const userInfo = document.getElementById('userInfo');
                const userName = document.getElementById('userName');
                
                userName.textContent = params.firstName;
                userInfo.style.display = 'block';
                
                console.log('‚úÖ Utilisateur identifi√©:', params.firstName);
            }
        }
        
        // üÜï GESTION DU BOUTON CTA AVEC REDIRECTION INTELLIGENTE
        function initializeCTAButton() {
            const ctaButton = document.getElementById('ctaButton');
            
            if (ctaButton) {
                ctaButton.addEventListener('click', async function() {
                    console.log('üöÄ CTA button clicked - Redirection intelligente vers formation');
                    
                    // Haptic feedback
                    if (navigator.vibrate) {
                        navigator.vibrate([50, 50, 100]);
                    }
                    
                    // R√©cup√©rer les param√®tres utilisateur
                    const params = getURLParams();
                    
                    // Track le clic
                    trackEvent('CTA Clicked - Formation Access', {
                        'cta_text': this.textContent.trim(),
                        'firstName': params.firstName,
                        'email': params.email,
                        'destination': 'formation_page'
                    });
                    
                    // Redirection intelligente vers la page de formation
                    try {
                        await smartRedirectToFormation(params.firstName, params.email);
                    } catch (error) {
                        console.error('‚ùå Erreur redirection intelligente, fallback simple:', error);
                        // Fallback simple vers formation.html
                        const fallbackUrl = new URL('/formation.html', window.location.origin);
                        if (params.firstName) fallbackUrl.searchParams.set('firstName', params.firstName);
                        if (params.email) fallbackUrl.searchParams.set('email', params.email);
                        window.location.href = fallbackUrl.toString();
                    }
                });
            }
        }
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üé¨ === PAGE VSL CHARG√âE (VERSION CORRIG√âE) ===');
            
            // Afficher les informations utilisateur
            displayUserInfo();
            
            // Initialiser le bouton CTA
            initializeCTAButton();
            
            // Track page view
            setTimeout(() => {
                const params = getURLParams();
                trackEvent('VSL Page Viewed', {
                    'firstName': params.firstName,
                    'email': params.email,
                    'referrer': document.referrer,
                    'url_params': params
                });
                
                console.log('‚úÖ Page VSL initialis√©e avec succ√®s');
                console.log('üìã Param√®tres re√ßus:', params);
            }, 1000);
        });
        
        // üÜï FONCTIONS DE DEBUG AM√âLIOR√âES
        window.testCTA = function() {
            console.log('üß™ Test CTA - Redirection formation');
            document.getElementById('ctaButton').click();
        };
        
        window.testFormationRedirect = function(testFirstName = 'TestUser', testEmail = 'test@example.com') {
            console.log('üß™ === TEST REDIRECTION FORMATION ===');
            smartRedirectToFormation(testFirstName, testEmail);
        };
        
        window.checkFormationUrl = function() {
            console.log('üß™ === TEST URLS FORMATION ===');
            checkPageAvailability().then(url => {
                console.log('URL disponible:', url);
            });
        };
        
        window.testDirectRedirect = function() {
            console.log('üß™ === TEST REDIRECTION DIRECTE ===');
            window.location.href = '/formation.html';
        };
        
        // Pour ajouter du contenu dynamiquement plus tard
        window.addVideoEmbed = function(embedCode) {
            const container = document.getElementById('videoContainer');
            container.innerHTML = embedCode;
            console.log('‚úÖ Contenu vid√©o ajout√©');
        };
        
        window.addImage = function(imageUrl, altText = 'Formation vid√©o') {
            const container = document.getElementById('videoContainer');
            container.innerHTML = `<img src="${imageUrl}" alt="${altText}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 12px;">`;
            console.log('‚úÖ Image ajout√©e');
        };
    </script>
</body>
</html>